import{r as o,j as P}from"./iframe-C6gT_53K.js";const $=o.createContext({}),{Provider:oe,Consumer:ce}=$,Z=()=>o.useContext($)||{};function ee(t,e){return e?G(t).reduce((n,[s,a])=>(B(e,s)&&(n[s]=a),n),{}):{}}function G(t){return Object.keys(t).map(e=>[e,t[e]])}function B(t,e){return!!t&&t.indexOf(e)!==-1}function ne(t,e){return!!t&&!!e&&[...Object.keys(t),...Object.keys(e)].every(n=>t[n]===e[n])}function te(t){return t&&typeof t.isDestroyed=="function"&&typeof t.destroy=="function"}function re(t){return te(t)&&t.isDestroyed()}function Q(t){return t&&typeof t=="object"&&"then"in t&&typeof t.then=="function"}const H="__RESIUM_EVENT_MANAGER",q=["onClick","onDoubleClick","onMouseDown","onMouseUp","onMiddleClick","onMiddleDown","onMiddleUp","onMouseMove","onPinchEnd","onPinchMove","onPinchStart","onRightClick","onRightDown","onRightUp","onWheel","onMouseEnter","onMouseLeave"];class Y{static eventTypeMap={onClick:Cesium.ScreenSpaceEventType.LEFT_CLICK,onDoubleClick:Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK,onMouseDown:Cesium.ScreenSpaceEventType.LEFT_DOWN,onMouseUp:Cesium.ScreenSpaceEventType.LEFT_UP,onMiddleClick:Cesium.ScreenSpaceEventType.MIDDLE_CLICK,onMiddleDown:Cesium.ScreenSpaceEventType.MIDDLE_DOWN,onMiddleUp:Cesium.ScreenSpaceEventType.MIDDLE_UP,onMouseMove:Cesium.ScreenSpaceEventType.MOUSE_MOVE,onPinchEnd:Cesium.ScreenSpaceEventType.PINCH_END,onPinchMove:Cesium.ScreenSpaceEventType.PINCH_MOVE,onPinchStart:Cesium.ScreenSpaceEventType.PINCH_START,onRightClick:Cesium.ScreenSpaceEventType.RIGHT_CLICK,onRightDown:Cesium.ScreenSpaceEventType.RIGHT_DOWN,onRightUp:Cesium.ScreenSpaceEventType.RIGHT_UP,onWheel:Cesium.ScreenSpaceEventType.WHEEL,onMouseEnter:Cesium.ScreenSpaceEventType.MOUSE_MOVE,onMouseLeave:Cesium.ScreenSpaceEventType.MOUSE_MOVE};scene;sshe;events={onClick:new Map,onDoubleClick:new Map,onMouseDown:new Map,onMouseUp:new Map,onMiddleClick:new Map,onMiddleDown:new Map,onMiddleUp:new Map,onMouseMove:new Map,onPinchEnd:new Map,onPinchMove:new Map,onPinchStart:new Map,onRightClick:new Map,onRightDown:new Map,onRightUp:new Map,onWheel:new Map,onMouseEnter:new Map,onMouseLeave:new Map};hovered=void 0;constructor(e){this.scene=e,this.sshe=new Cesium.ScreenSpaceEventHandler(e?.canvas)}destroy(){this.hovered=void 0,this.sshe.isDestroyed()||this.sshe.destroy()}isDestroyed(){return this.sshe.isDestroyed()}on(e,n,s){e&&n==="onWheel"||this.events[n].set(e,s)}off(e,n){this.events[n].delete(e),this.hovered===e&&(this.hovered=void 0)}setEvents(e,n){G(n).forEach(([s,a])=>{const l=s;B(q,l)&&(a?this.on(e,l,a):this.off(e,l))}),this.commit()}clearEvents(e){this.hovered=void 0,q.forEach(n=>{this.off(e,n)}),this.commit()}commit(){const e=this.sshe,n=this.sshe.isDestroyed();n||(this.events.onMouseEnter.size===0&&this.events.onMouseLeave.size===0&&this.events.onMouseMove.size===0?this.sshe.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE):this.sshe.getInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE)||this.sshe.setInputAction(this.onMouseMove,Cesium.ScreenSpaceEventType.MOUSE_MOVE)),G(this.events).forEach(([s,a])=>{if(s==="onMouseEnter"||s==="onMouseLeave"||s==="onMouseMove")return;const l=Y.eventTypeMap[s];n||(a.size===0?e.removeInputAction(l):e.getInputAction(l)||e.setInputAction(this.eventCallback(s),l))})}getScreenSpaceEventHandler(){return this.sshe}getEventCallback(e,n){return n===null?this.events[e].get(null):this.events[e].get(n.id)||this.events[e].get(n.id?.entityCollection?.owner)||this.events[e].get(n.primitive)||this.events[e].get(n.tileset)}onMouseMove=e=>{const n=this.pick(e.endPosition);this.hovered!==n&&(this.hovered&&(this.getEventCallback("onMouseLeave",this.hovered)?.(e,this.hovered),this.getEventCallback("onMouseLeave",null)?.(e,this.hovered)),n&&(this.getEventCallback("onMouseEnter",n)?.(e,n),this.getEventCallback("onMouseEnter",null)?.(e,n))),n&&this.getEventCallback("onMouseMove",n)?.(e,n),this.getEventCallback("onMouseMove",null)?.(e,n),this.hovered=n};eventCallback=e=>n=>{const s=this.pick(n?.position);s&&this.getEventCallback(e,s)?.(n,s),this.getEventCallback(e,null)?.(n,s)};pick(e){if(e)return this.scene?.pick(e)}}const se=({name:t,create:e,destroy:n,provide:s,update:a,cesiumReadonlyProps:l,cesiumEventProps:C,otherProps:j,setCesiumPropsAfterCreate:M,useCommonEvent:m,useRootEvent:v},y,k)=>{const r=o.useRef(void 0),f=Z(),S=o.useRef(s?{}:void 0),g=o.useRef({}),d=o.useRef(X(y)),h=o.useRef({}),[T,J]=o.useState(!1),O=o.useRef(!1),x=o.useRef(null),U=o.useRef(void 0),A=f?.[H],E=o.useRef(void 0),D=o.useRef(void 0),N=o.useCallback(async u=>{if(!r.current)return;const c=r.current,p=Object.keys(u),w=Object.keys(C||[]),I=p.concat(Object.keys(h.current).filter(i=>!p.includes(i))).filter(i=>h.current[i]!==u[i]).map(i=>[i,h.current[i],u[i]]),R=[];for(const[i,F,b]of I)if(l?.includes(i))R.push(i);else if(B(w,i)){const z=C?.[i],L=c[z];L instanceof Cesium.Event&&(typeof F>"u"?(L.addEventListener(b),g.current[z]=b):typeof b>"u"?(L.removeEventListener(F),delete g.current[z]):(L.removeEventListener(F),L.addEventListener(b)))}else i!=="children"&&!q.includes(i)&&!j?.includes(i)&&(c[i]=b);const _=v?S.current?.[H]:A;if(m&&_&&r.current&&_.setEvents(v?null:r.current,u),a&&O.current){const i=a(r.current,u,h.current,f);Q(i)&&await i}h.current=u,d.current=u,O.current&&R.length>0&&(K(),await V(),E.current=W())},[]),W=o.useCallback(async()=>{await new Promise(w=>queueMicrotask(()=>w(void 0)));const u=e?.(f,d.current,x.current);let c;if(Q(u)?c=await u:c=u,Array.isArray(c)?(r.current=c[0],U.current=c[1]):r.current=c,M)await N(d.current);else{if(r.current&&C){const w=r.current;for(const I of Object.keys(d.current)){const R=C[I];if(R){const _=d.current[I],i=w[R];_&&i instanceof Cesium.Event&&i.addEventListener(_)}}}h.current=d.current}s&&r.current&&(S.current={...f,...s(r.current,f,y,U.current)});const p=v?S.current?.[H]:A;m&&p&&r.current&&p.setEvents(v?null:r.current,d.current),D.current||J(!0)},[]),K=o.useCallback(()=>{J(!1),O.current=!1},[]),V=o.useCallback(async()=>{await new Promise(c=>queueMicrotask(()=>c(void 0))),E.current&&(await E.current,E.current=void 0),r.current&&n&&n(r.current,f,x.current,U.current);const u=v?S.current?.[H]:A;if(m&&u&&r.current&&u.clearEvents(v?null:r.current),r.current&&!re(r.current)){const c=Object.keys(g.current);for(const p of c)r.current[p]?.removeEventListener?.(g.current[p])}g.current={},S.current=void 0,U.current=void 0,r.current=void 0},[]);return o.useLayoutEffect(()=>((async()=>(D.current&&(await D.current,D.current=void 0),E.current=W()))(),()=>{K(),D.current=V()}),[W,V,K]),o.useEffect(()=>{(async()=>{E.current&&await E.current;const c=X(y);T?ne(c,h.current)||(await N(c),f.__$internal?.onUpdate?.()):(h.current=c,d.current=c,O.current=!0)})()},[f.__$internal,T,y,N]),o.useImperativeHandle(k,()=>({cesiumElement:T?r.current:null}),[T]),[S.current,T,x]};function X(t){const{children:e,...n}=t;return n}const ue=({renderContainer:t,noChildren:e,containerProps:n,defaultProps:s,...a})=>{const l=(C,j)=>{const M={...s,...C},[m,v,y]=se(a,M,j);if(e)return null;const k=v&&"children"in M?M.children:null,r=t?P.jsx("div",{"data-testid":"resium-container",ref:y,...typeof n=="function"?n(M):ee(M,n),children:k}):k?P.jsx(P.Fragment,{children:k}):null;return m?P.jsx($.Provider,{value:m,children:r}):r};return l.displayName=a.name,o.forwardRef(l)};export{Y as E,B as a,ue as c,H as e,Q as i,Z as u};
